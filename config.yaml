# config.yaml
# This file contains the default configuration

# Global setting
config_path: 'config.yaml'
enable_seed: True  # apply seed globally
seed: 42
enable_gpu: True
enable_rewrite_output_dir: True
output_dir: 'C:\mydata\output\p2_ded_bead_profile\v4.1'
enable_uuid_naming: True # if false, use customized naming
extra_name: 'sample_100.enc_200.dec_100.pool_200.batch_128.ffd_bilstm.embed_6.lr_1.2e-4_0.985.wd_1e-4.mse_iou'
enable_computational_test: False

# Data
dataset_dir: 'C:\mydata\dataset\p2_ded_bead_profile\20240730'
## Dataset
dataset_name: 'High_const_sin_1_dataset.pt' # 'simu_data' for random init, not used when enable_iterate_dataset == True
enable_iterate_dataset: True # iterate for all sub datasets in the dataset_dir
dataset_iterate_ratio: 1.0 # use only portion of the dataset
sys_sampling_interval: 100  # systematic sampling interval <--------------------------------------------
raw_timestamp_interval: 2.5  # ms
raw_data_size: 121
## Data loader
dataset_exclude: ['Low_noise_noise_1_dataset.pt', 'Low_noise_noise_2_dataset.pt', 'Low_const_const_1_dataset.pt', 'Low_const_const_2_dataset.pt', 'High_sin_tooth_1_dataset.pt', 'High_sin_tooth_2_dataset.pt'] # used when enable_deploy_dataset == True
enable_deploy_dataset: False
train_val_test_ratio: [0.8, 0.1, 0.1]
batch_size: 128
num_workers: 0  # no need to set if all data in GPU
## Special filter
enable_rtcp: 'both' # 'on_only', 'off_only' 'both'
## Sequence length
n_seq_enc_look_back: 100
n_seq_enc_look_ahead: 99
n_seq_enc_total: 200
n_seq_dec_look_back: 100
n_seq_dec_pool: 200
## Feature / Img
enable_resnet_preprocess: True
img_crop_pixel: 350   # cropped from 480x440
img_input_size: 224   # resized the cropped img
img_start_idx: 0    # shift in starting index
## Feature / Parameter and positional
param_start_idx: 2
param_size: 11   # number of expr. parameters
pos_start_idx: 0
pos_size: 15 # time, position, distance
## Feature / Output
enable_standardization: False # not supported
output_start_index: 13
output_size: 40
output_noise_cutoff: 0.01

# Model
model: "STEN_GP_FFD_BLSTM"  # None, STEN_GP_FA_TA, STEN_GP_FFD, STEN_GP_TA_FFD, STEN_GP_FFD_TA, STEN_GP_FFD_BLSTM
enable_param_init: False  # default init method: kaiming_normal_
## embedding
enable_img_embed: True   # --- ABLATION
enable_param_embed: True  # --- ABLATION
enable_pos_embed: True  # --- ABLATION
enable_img_embed_resize: False   # --- ABLATION
enable_param_embed_resize: True  # --- ABLATION
enable_pos_embed_resize: True  # --- ABLATION
feature_embed_option: 'default' # 'fc', 'default'
img_embed_dim: 512    # number of conv. features
param_embed_dim: 6
pos_embed_dim: 6
embed_dim: 668 #616-4, 668-6, 720-8
## encoder
encoder_layer_size: 1   # --- ABLATION
encoder_num_heads: 4
enable_residual_gamma: False   # --- ABLATION
enable_layer_norm: True
enable_dropout: True
dropout: 0.3
## decoder
decoder_option: 'transformer'
output_option: 'Profile40' #'WHA', 'W4HA',
output_embed_dim: 6

# Training
# criterion
criterion_option: 'mae_mse_iou' # 'mse', 'iou', 'mse_iou', 'mae_mse_iou'
criterion_mae_lambda: 0.0
criterion_mse_lambda: 0.9
criterion_iou_lambda: 0.1
# optimizer
num_epochs: 80
optimizer_option: 'adam_Vaswani_2017' # adam
lr: 1.2e-4  # learning rate 1.0e-4
enable_weight_decay: True
wd: 1.0e-4  # weight decay
enable_adaptive_lr: True
lr_gamma: 0.985  # lr reduction factor for each epoch 0.985, 0.96
lr_adaptive_max_epoch: 1000
# cross-validation
early_stopping: False

# Checkpoint
checkpoint_dir: './'
enable_save_best_model: True
checkpoint_epoch_interval: 10

# Log
log_dir: 'logs/'
enable_tensorboard: True
enable_save_history_stats_to_csv: True
enable_save_attention: False
enable_save_residual: False

